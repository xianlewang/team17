;18649 Fall 2013
;Group 17
;Qiang Zhang(qiangz)
;doorcontrol_test1.mf

#INCLUDE door_defines.mf ;include CAN ID and Period Definations
;initialize
0s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N ATFLOOR_2F_FRONT_CAN_ID AtFloor 2 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_4F_FRONT_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_5F_FRONT_CAN_ID AtFloor 5 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_6F_FRONT_CAN_ID AtFloor 6 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_7F_FRONT_CAN_ID AtFloor 7 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_8F_FRONT_CAN_ID AtFloor 8 FRONT = false
0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 UP
0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
0s I MESSAGE_PERIOD N DOOR_CLOSED_OTHER_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0
0s I MESSAGE_PERIOD N HALLCALL_3F_CAN_ID HallCall 3 FRONT UP = true
0s I MESSAGE_PERIOD N HALLLIGHT_3F_CAN_ID HallLight 3 FRONT UP = true

; check the door motor is stop initially
0.11s A F DoorMotor FRONT RIGHT : command == STOP

; T 5.1
0.2s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = true
0.2s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = false
0.2s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0.3s A F DoorMotor FRONT LEFT : command == OPEN
0.3s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN

; T 5.2
0.3s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false
0.3s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
1.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
1.5s A F DoorMotor FRONT LEFT : command == STOP
1.5s A S DoorControl[FRONT][LEFT] : STATE == OPENED

; T 5.3
6.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
6.0s A F DoorMotor FRONT LEFT : command == CLOSE
6.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

; T 5.4
7.0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true
7.1s A F DoorMotor FRONT LEFT : command == STOP
7.1s A S DoorControl[FRONT][LEFT] : STATE == WAIT_DISPATCHER

; T 5.13
9.0s A F DoorMotor FRONT LEFT : command == STOP
9.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSED

; lead to S 5.4
10.0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
10.5s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false
11.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
11.0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
15.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
16.0s A F DoorMotor FRONT LEFT : command == CLOSE
16.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

; T 5.5
16.5s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
17.0s A F DoorMotor FRONT LEFT : command == OPEN
17.0s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN

; lead to S 5.8
18.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
18.0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 1500
22.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
25.0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true

; T 5.15
25.1s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
25.1s I MESSAGE_PERIOD N DOOR_CLOSED_OTHER_CAN_ID DoorClosed FRONT RIGHT = true
25.3s I MESSAGE_PERIOD N DOOR_CLOSED_OTHER_CAN_ID DoorClosed FRONT RIGHT = false
25.5s A F DoorMotor FRONT LEFT : command == OPEN
25.5s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN
25.5s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false

; lead to S 5.4
26.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
26.0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
31.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
32.0s A F DoorMotor FRONT LEFT : command == CLOSE
32.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

; T 5.8
33.0s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = true
33.5s A F DoorMotor FRONT LEFT : command == OPEN
33.5s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_OPEN
33.5s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = false

; T 5.9
34.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
34.2s A F DoorMotor FRONT LEFT : command == STOP
34.2s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_OPENED

;T 5.10
39.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
39.1s A F DoorMotor FRONT LEFT : command == NUDGE
39.1s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_CLOSING

;T 5.11
39.5s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = true
40.0s A F DoorMotor FRONT LEFT : command == OPEN
40.0s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_OPEN

;lead to S 5.7
40.2s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = false
41.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
45.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
46.0s A F DoorMotor FRONT LEFT : command == NUDGE
46.0s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_CLOSING

; T 5.10
46.5s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true
46.6s A F DoorMotor FRONT LEFT : command == STOP
46.6s A S DoorControl[FRONT][LEFT] : STATE == WAIT_DISPATCHER

; to S 5.1
48.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSED

; T 5.6
48.5s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = true
49.0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false
49.0s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = false
50.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
55.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false

; T 5.14
56.0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
56.5s A F DoorMotor FRONT LEFT : command == OPEN
56.5s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN
56.8s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP

; lead to S 5.7
58.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
62.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
64.0s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = true
64.5s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = false
66.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
70.0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
71.0s A F DoorMotor FRONT LEFT : command == NUDGE
71.0s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_CLOSING

; T 5.12
71.5s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
72.0s A F DoorMotor FRONT LEFT : command == OPEN
72.0s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN













