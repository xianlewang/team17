; 18649 Fall 2013
; group 17
; Qiang Zhang(qiangz)
; doorcontrol_test1.mf

#INCLUDE door_defines.mf ;include CAN ID and Period Definations
;initialize
0s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N ATFLOOR_2F_FRONT_CAN_ID AtFloor 2 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_4F_FRONT_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_5F_FRONT_CAN_ID AtFloor 5 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_6F_FRONT_CAN_ID AtFloor 6 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_7F_FRONT_CAN_ID AtFloor 7 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_8F_FRONT_CAN_ID AtFloor 8 FRONT = false
0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 UP
0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0
0s I MESSAGE_PERIOD N HALLCALL_3F_CAN_ID HallCall 3 FRONT UP = true
0s I MESSAGE_PERIOD N HALLLIGHT_3F_CAN_ID HallLight 3 FRONT UP = true

;check the door motor is stop initially
0.11s A F DoorMotor FRONT RIGHT : command == STOP

;set contidions to T 5.1
0.20s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = true
0.20s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0.20s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = false

;T 5.1
; check the door motor is open && check current state
0.32s A F DoorMotor FRONT LEFT : command == OPEN
0.32s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN

0.34s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false

;T 5.2
0.40s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true

; check the door motor is stop && check current state
0.52s A F DoorMotor FRONT LEFT : command == STOP
0.52s A S DoorControl[FRONT][LEFT] : STATE == OPENED
;T 5.3
11.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
11.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP

; check the door motor is close && check current state
11.10s A F DoorMotor FRONT LEFT : command == CLOSE
11.10s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

;T 5.4
12.00s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = true
12.10s A F DoorMotor FRONT LEFT : command == STOP
12.10s A S DoorControl[FRONT][LEFT] : STATE == WAIT_DISPATCHER
14.00s A S DoorControl[FRONT][LEFT] : STATE == CLOSED

;T 5.1, T 5.2, T 5.3
15.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
15.10s A F DoorMotor FRONT LEFT : command == OPEN
15.10s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN
15.10s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT LEFT = false
;T 5.5
16.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
16.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
;T 5.6
16.10s A F DoorMotor FRONT LEFT : command == STOP
16.10s A S DoorControl[FRONT][LEFT] : STATE == OPENED
;T 5.11
27.50s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
27.60s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

;T 5.7
28.00s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = true
;T 5.14
28.10s A F DoorMotor FRONT LEFT : command == OPEN
28.10s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_OPEN
28.10s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT LEFT = false

;T 5.8
29.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = true
;T 5.13
29.10s A F DoorMotor FRONT LEFT : command == STOP
29.10s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_OPENED

;T 5.9
41.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT LEFT = false
42.00s A F DoorMotor FRONT LEFT : command == NUDGE
42.00s A S DoorControl[FRONT][LEFT] : STATE == REVERSE_CLOSING

;T 5.12
43.00s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
43.10s A F DoorMotor FRONT LEFT : command == OPEN
43.10s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN















