; 18649 Fall 2013
; group 17
; Qiang Zhang(qiangz)
; doorcontrol_test1.mf

#INCLUDE door_defines.mf ;include CAN ID and Period Definations
;initialize
0s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N ATFLOOR_2F_FRONT_CAN_ID AtFloor 2 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_4F_FRONT_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_5F_FRONT_CAN_ID AtFloor 5 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_6F_FRONT_CAN_ID AtFloor 6 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_7F_FRONT_CAN_ID AtFloor 7 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_8F_FRONT_CAN_ID AtFloor 8 FRONT = false
0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveCommand = SLOW UP
0s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
0s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0

; check the door motor is stop initially
0.11s A F DoorMotor FRONT RIGHT : command == STOP

;set contidions to T 5.1
0.20s I MESSAGE_PERIOD N ATFLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = true
0.20s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveCommand = STOP STOP
0.20s I MESSAGE_PERIOD N ATFLOOR_1F_FRONT_CAN_ID AtFloor 1 FRONT = false

;T 5.1
; check the door motor is open && check current state
0.32s A F DoorMotor FRONT RIGHT : command == OPEN
0.32s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN

0.34s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = false

;T 5.2
0.40s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true

; check the door motor is stop && check current state
0.52s A F DoorMotor FRONT RIGHT : command == STOP
0.52s A S DoorControl[FRONT][RIGHT] : STATE == OPENED
1.40s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
1.40s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP

;T 5.3
; check the door motor is nudge && check current state
1.51s A F DoorMotor FRONT RIGHT : command == CLOSE
1.51s A S DoorControl[FRONT][RIGHT] : STATE == CLOSING

;T 5.5
1.55s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
; check the door motor is open && check current state
1.60s A F DoorMotor FRONT RIGHT : command == OPEN
1.60s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN
1.64s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 100

;T 5.2 -> T 5.3
1.70s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
2.70s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false

;T 5.4
4.80s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = true
; check the door motor is closed && check current state
4.90s A F DoorMotor FRONT RIGHT : command == STOP
4.90s A S DoorControl[FRONT][RIGHT] : STATE == CLOSED

;T 5.6
5.00s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
5.02s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = false
; check the door motor is open && check current state
5.10s A F DoorMotor FRONT RIGHT : command == OPEN
5.10s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN

;T 5.2
5.20s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0
5.40s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
;T 5.3
6.50s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
;T 5.7
7.00s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = true
; check the door motor is open && check current state
7.20s A F DoorMotor FRONT RIGHT : command == OPEN
7.20s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_OPEN

7.25s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = false

;T 5.8
7.30s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
7.40s A F DoorMotor FRONT RIGHT : command == STOP
7.40s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_OPENED
8.30s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false

;T 5.9
8.40s A F DoorMotor FRONT RIGHT : command == NUDGE
8.40s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_CLOSING

;T 5.10
9.00s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = true
9.10s A F DoorMotor FRONT RIGHT : command == STOP
9.10s A S DoorControl[FRONT][RIGHT] : STATE == CLOSED

; lead to S 5.4
10.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
10.10s A F DoorMotor FRONT RIGHT : command == OPEN
10.10s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN
10.20s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
10.20s I MESSAGE_PERIOD N DOOR_CLOSED_CAN_ID DoorClosed FRONT RIGHT = false
11.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
12.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false

12.50s A F DoorMotor FRONT RIGHT : command == CLOSE
12.50s A S DoorControl[FRONT][RIGHT] : STATE == CLOSING
12.60s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP

;T 5.13
13.00s A F DoorMotor FRONT RIGHT : command == OPEN
13.00s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN

; lead to S 5.5
13.20s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
14.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
15.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
15.50s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = true
15.70s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = false

; make sure in S 5.5
16.00s A F DoorMotor FRONT RIGHT : command == OPEN
16.00s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_OPEN

; to S 5.7
16.50s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
17.50s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false

; T 5.11
19.00s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = true
19.10s A F DoorMotor FRONT RIGHT : command == OPEN
19.10s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_OPEN

; to S 5.7
19.20s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = false
20.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
21.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false

; T 5.12
21.50s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 15000
21.60s A F DoorMotor FRONT RIGHT : command == OPEN
21.60s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN

; to S 5.7
22.00s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 100
22.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
23.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
23.50s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = true
24.00s I MESSAGE_PERIOD N DOOR_REVERSAL_CAN_ID DoorReversal FRONT RIGHT = false
24.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = true
25.00s I MESSAGE_PERIOD N DOOR_OPENED_CAN_ID DoorOpened FRONT RIGHT = false
25.50s A F DoorMotor FRONT RIGHT : command == NUDGE
25.50s A S DoorControl[FRONT][RIGHT] : STATE == REVERSE_CLOSING

; T 5.14
26.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
26.50s A F DoorMotor FRONT RIGHT : command == OPEN
26.50s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN
27.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP





