;18649 Fall 2013
;Group 17
;Xianle Wang(xianlew)
;dispatcher_test1.mf

;this test file demonstrates network and framework message injections
;and network, framework, and controller state assertions.

#INCLUDE disp-define.mf

;intialize 
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true

0s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N AT_FLOOR_[1][BACK]_CAN_ID AtFloor 1 BACK = false
0s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = false
0s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false

0s I MESSAGE_PERIOD N HALL_CALL_[1][BACK][UP]_CAN_ID HallCall 1 BACK UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[2][BACK][UP]_CAN_ID HallCall 2 BACK UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[2][BACK][DOWN]_CAN_ID HallCall 2 BACK DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[3][FRONT][UP]_CAN_ID HallCall 3 FRONT UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[3][FRONT][DOWN]_CAN_ID HallCall 3 FRONT DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[4][FRONT][UP]_CAN_ID HallCall 4 FRONT UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[4][FRONT][DOWN]_CAN_ID HallCall 4 FRONT DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[5][FRONT][UP]_CAN_ID HallCall 5 FRONT UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[5][FRONT][DOWN]_CAN_ID HallCall 5 FRONT DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[6][FRONT][UP]_CAN_ID HallCall 6 FRONT UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[6][FRONT][DOWN]_CAN_ID HallCall 6 FRONT DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[7][FRONT][UP]_CAN_ID HallCall 7 FRONT UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[7][FRONT][DOWN]_CAN_ID HallCall 7 FRONT DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[7][BACK][UP]_CAN_ID HallCall 7 BACK UP = false
0s I MESSAGE_PERIOD N HALL_CALL_[7][BACK][DOWN]_CAN_ID HallCall 7 BACK DOWN = false
0s I MESSAGE_PERIOD N HALL_CALL_[8][FRONT][DOWN]_CAN_ID HallCall 8 FRONT DOWN = false

0s I MESSAGE_PERIOD N CAR_CALL_[1][FRONT]_CAN_ID CarCall 1 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[1][BACK]_CAN_ID CarCall 1 BACK = false
0s I MESSAGE_PERIOD N CAR_CALL_[2][BACK]_CAN_ID CarCall 2 BACK = false
0s I MESSAGE_PERIOD N CAR_CALL_[3][FRONT]_CAN_ID CarCall 3 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[4][FRONT]_CAN_ID CarCall 4 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[5][FRONT]_CAN_ID CarCall 5 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[6][FRONT]_CAN_ID CarCall 6 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[7][FRONT]_CAN_ID CarCall 7 FRONT = false
0s I MESSAGE_PERIOD N CAR_CALL_[7][BACK]_CAN_ID  CarCall 7 BACK  = false
0s I MESSAGE_PERIOD N CAR_CALL_[8][FRONT]_CAN_ID CarCall 8 FRONT = false

0s I MESSAGE_PERIOD N CAR_LEVEL_POSITION_CAN_ID CarLevelPosition = 0

;speed unit is m/s
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP

;I have modified initialization and defines.cf file - Jiang He
;following test code remain unchanged 

;check
;#state S11.1 IDLE
0.21s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 1
0.21s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == STOP
0.21s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getHallway == NONE
0.21s A S DispatcherControl : STATE == IDLE

;set condition to T11.1
0.4s I MESSAGE_PERIOD N HALL_CALL_[3][FRONT][DOWN]_CAN_ID HallCall 3 FRONT DOWN = true
;check
;#state S11.4 REACH
0.6s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 3
0.6s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == DOWN
0.6s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getHallway == FRONT
;set condition to T11.6
;check
;#state S11.5 LEAVE
0.6s A S DispatcherControl : STATE == LEAVE
0.6s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0.7 UP
;set condition to T11.5
0.65s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = false
0.65s I MESSAGE_PERIOD N CAR_LEVEL_POSITION_CAN_ID CarLevelPosition = 3000
;check
;#state S11.2 OPERATING
0.8s A S DispatcherControl : STATE == OPERATING
;set condition to T11.4
0.8s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0.8s I MESSAGE_PERIOD N CAR_LEVEL_POSITION_CAN_ID CarLevelPosition = 10000
0.8s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = true
0.8s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false
;check
;#state S11.4 REACH
0.9s A S DispatcherControl : STATE == REACH
;set to condition T11.2 
1.0s I MESSAGE_PERIOD N HALL_CALL_[3][FRONT][DOWN]_CAN_ID HallCall 3 FRONT DOWN = false
1.0s I MESSAGE_PERIOD N HALL_CALL_[2][BACK][UP]_CAN_ID HallCall 2 BACK UP = false
1.0s I MESSAGE_PERIOD N HALL_CALL_[2][BACK][DOWN]_CAN_ID HallCall 2 BACK DOWN = false
1.0s I MESSAGE_PERIOD N HALL_CALL_[3][FRONT][DOWN]_CAN_ID HallCall 3 FRONT DOWN = false
1s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
1s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
1s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
1s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true
;check
;#state S11.1 IDLE
2.2s A S DispatcherControl : STATE == IDLE
;set to condition T11.3
2.5s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false
2.5s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false
;check
;#state S11.3 EMERGENCY
3s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 1
3s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == STOP
3s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getHallway == NONE
3s A S DispatcherControl : STATE == EMERGENCY
