; 18649 Fall 2013
; group 17
; Jiang He (jiangh)
; sd8a.mf


;network message period
#DEFINE MESSAGE_PERIOD 10ms

#DEFINE AT_FLOOR_[1][FRONT]_CAN_ID 0xC4C2800
#DEFINE AT_FLOOR_[1][BACK]_CAN_ID 0xC4C2801
#DEFINE AT_FLOOR_[2][BACK]_CAN_ID 0xC4C2803
#DEFINE AT_FLOOR_[3][FRONT]_CAN_ID 0xC4C2804
#DEFINE AT_FLOOR_[4][FRONT]_CAN_ID 0xC4C2806
#DEFINE AT_FLOOR_[5][FRONT]_CAN_ID 0xC4C2808
#DEFINE AT_FLOOR_[6][FRONT]_CAN_ID 0xC4C280A
#DEFINE AT_FLOOR_[7][FRONT]_CAN_ID 0xC4C280C
#DEFINE AT_FLOOR_[7][BACK]_CAN_ID 0xC4C280D
#DEFINE AT_FLOOR_[8][FRONT]_CAN_ID 0xC4C280E

#DEFINE DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID 0xF0EB800
#DEFINE DOOR_MOTOR_COMMAND_[FRONT][RIGHT]_CAN_ID 0xF0EB801
#DEFINE DOOR_MOTOR_COMMAND_[BACK][LEFT]_CAN_ID 0xF0EB802
#DEFINE DOOR_MOTOR_COMMAND_[BACK][RIGHT]_CAN_ID 0xF0EB803

;mDesiredFloor
#DEFINE DESIRED_FLOOR_CAN_ID                           0xF0CB600

;mDoorClosed
#DEFINE DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID        0xD145000
#DEFINE DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID       0xD145001
#DEFINE DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID         0xD145002
#DEFINE DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID        0xD145003

;mDrive
#DEFINE DRIVE_COMMAND_CAN_ID									 0xF0AB500
;mDriveSpeed
#DEFINE DRIVE_SPEED_CAN_ID                             0xF09B500

;mDoorOpened
#DEFINE DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID          0xEA4A000
#DEFINE DOOR_OPEN_SENSOR_[FRONT][RIGHT]_CAN_ID         0xEA4A001
#DEFINE DOOR_OPEN_SENSOR_[BACK][LEFT]_CAN_ID           0xEA4A002
#DEFINE DOOR_OPEN_SENSOR_[BACK][RIGHT]_CAN_ID          0xEA4A003

;mCarWeight = 0x0DDC7800
#DEFINE CAR_WEIGHT_CAN_ID  0x0DDC7800

;mLevel
#DEFINE LEVEL_SENSOR_[UP]_CAN_ID 0xAE81400
#DEFINE LEVEL_SENSOR_[DOWN]_CAN_ID 0xAE81401

;mEmergencyBrake
#DEFINE EMERGENCY_BRAKE_CAN_ID	0xBE81400

;mHoistwayLimit
#DEFINE HOISTWAY_LIMIT_[UP]_CAN_ID	0xF08B400
#DEFINE HOISTWAY_LIMIT_[DOWN]_CAN_ID	0xF08B401


;intialize 
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true

0s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = false
0s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[4][FRONT]_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[5][FRONT]_CAN_ID AtFloor 5 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[6][FRONT]_CAN_ID AtFloor 6 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[7][FRONT]_CAN_ID AtFloor 7 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[8][FRONT]_CAN_ID AtFloor 8 FRONT = false

0s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = false
0s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = false

;trigger DoorMotor to OPEN
;#arc '8A/1a'
1s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
1s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
1s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

;trigger mDesiredFloor to change
1.5s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false
1.5s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = false
1.5s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = false
1.5s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = false

2.3s A F DoorMotor FRONT LEFT : command == OPEN

3.0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true
3.0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_[FRONT][RIGHT]_CAN_ID DoorOpened FRONT RIGHT = true
3.0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_[BACK][LEFT]_CAN_ID DoorOpened BACK LEFT = true
3.0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_[BACK][RIGHT]_CAN_ID DoorOpened BACK RIGHT = true

;#arc '8A/2'
7.0s A F DoorMotor FRONT LEFT : command == NUDGE

;#arc '8A/3a'
8s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
8s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
8s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
8s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true

;#arc '8A/3b'
8.2s A F DoorMotor FRONT LEFT : command == STOP
8.2s A F DoorMotor FRONT RIGHT : command == STOP
8.2s A F DoorMotor BACK LEFT : command == STOP
8.2s A F DoorMotor BACK RIGHT : command == STOP

;8.2s A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotor : getDoorCommand == STOP
;8.2s A N DOOR_MOTOR_COMMAND_[FRONT][RIGHT]_CAN_ID DoorMotor : getDoorCommand == STOP
;8.2s A N DOOR_MOTOR_COMMAND_[BACK][LEFT]_CAN_ID DoorMotor : getDoorCommand == STOP
;8.2s A N DOOR_MOTOR_COMMAND_[BACK][RIGHT]_CAN_ID DoorMotor : getDoorCommand == STOP


;#arc '8A/4a'


;#arc '8A/4b'
9s A F Drive : speed == SLOW
9s A F Drive : direction == UP



;#arc '8A/5'
10s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = false
10s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = true
10s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = false
10s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = false

;#arc '8A/6a'
11s I MESSAGE_PERIOD N EMERGENCY_BRAKE_CAN_ID Boolean = true

;#arc '8A/6b'
12s A F Drive : speed == STOP
12s A N DRIVE_COMMAND_CAN_ID DriveCommand : getSpeed == STOP

;13s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
;13s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

;****verify postcondition
15s A F Drive : speed == STOP
15s A N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT : getValue == true
15s A F DoorMotor FRONT LEFT : command == STOP


