; 18649 Fall 2013
; group 17
; Xianle Wang(xianlew)
; sd9a.mf


;network message period
#DEFINE MESSAGE_PERIOD 100ms

#DEFINE AT_FLOOR_[1][FRONT]_CAN_ID 0xC4C2800
#DEFINE AT_FLOOR_[1][BACK]_CAN_ID 0xC4C2801
#DEFINE AT_FLOOR_[2][BACK]_CAN_ID 0xC4C2803
#DEFINE AT_FLOOR_[3][FRONT]_CAN_ID 0xC4C2804
#DEFINE AT_FLOOR_[4][FRONT]_CAN_ID 0xC4C2806
#DEFINE AT_FLOOR_[5][FRONT]_CAN_ID 0xC4C2808
#DEFINE AT_FLOOR_[6][FRONT]_CAN_ID 0xC4C280A
#DEFINE AT_FLOOR_[7][FRONT]_CAN_ID 0xC4C280C
#DEFINE AT_FLOOR_[7][BACK]_CAN_ID 0xC4C280D
#DEFINE AT_FLOOR_[8][FRONT]_CAN_ID 0xC4C280E

#DEFINE DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID 0xF0EB800
#DEFINE DOOR_MOTOR_COMMAND_[FRONT][RIGHT]_CAN_ID 0xF0EB801
#DEFINE DOOR_MOTOR_COMMAND_[BACK][LEFT]_CAN_ID 0xF0EB802
#DEFINE DOOR_MOTOR_COMMAND_[BACK][RIGHT]_CAN_ID 0xF0EB803

;mDesiredFloor
;ID = 0x0F0CB600
#DEFINE DESIRED_FLOOR_CAN_ID 0xF0CB600 

;mDoorClosed
#DEFINE DOOR_CLOSED_FL_CAN_ID 0xD145000
#DEFINE DOOR_CLOSED_FR_CAN_ID 0xD145001
;mDriveSpeed = 0x0F0AB500
;#DEFINE DRIVE_COMMAND_CAN_ID 0x0F0AB500

;mDoorOpened = 0x0EA4A000 + 0 + 0 = 0x0EA4A001
#DEFINE DOOR_OPENED_FL_CAN_ID  0x0EA4A000
#DEFINE DOOR_OPENED_FR_CAN_ID 0xEA4A001

;mCarWeight = 0x0DDC7800
#DEFINE CAR_WEIGHT_CAN_ID  0x0DDC7800

#DEFINE LEVEL_SENSOR_[UP]_CAN_ID 0xAE81400
#DEFINE LEVEL_SENSOR_[DOWN]_CAN_ID 0xAE81401


;intialize 
0s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_FR_CAN_ID DoorClosed FRONT RIGHT = true

0s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = false
0s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[4][FRONT]_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[5][FRONT]_CAN_ID AtFloor 5 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[6][FRONT]_CAN_ID AtFloor 6 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[7][FRONT]_CAN_ID AtFloor 7 FRONT = false
0s I MESSAGE_PERIOD N AT_FLOOR_[8][FRONT]_CAN_ID AtFloor 8 FRONT = false

;0s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
;0s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true
0.2s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT LEFT = false
0.2s I MESSAGE_PERIOD N DOOR_CLOSED_FR_CAN_ID DoorClosed FRONT RIGHT = false


;****verify precondition
1s A N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT LEFT : getValue == false
1s A F DoorMotor FRONT LEFT : command == OPEN
1s A N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT : getValue == true

;#arc '9A/1a'
1s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
1s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
1s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

;#arc '9A/1b'
1.2s A F DoorMotor FRONT LEFT : command == OPEN

;#arc '9A/2'
1.5s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 2
1.5s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == UP


;#arc '9A/3'
1.5s I MESSAGE_PERIOD N DOOR_OPENED_FL_CAN_ID DoorOpened FRONT LEFT = true
1.5s I MESSAGE_PERIOD N DOOR_OPENED_FR_CAN_ID DoorOpened FRONT RIGHT = true

;#arc '9A/4'
2.0s A F DoorMotor FRONT LEFT : command == STOP

;#arc '9A/5'
7.0s A F DoorMotor FRONT LEFT : command == STOP
7.2s I MESSAGE_PERIOD N DOOR_OPENED_FL_CAN_ID DoorOpened FRONT LEFT = false

;#arc '9A/6a'
8s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT LEFT = true
8s I MESSAGE_PERIOD N DOOR_CLOSED_FR_CAN_ID DoorClosed FRONT RIGHT = true

;#arc '9A/6b'
8.2s A F DoorMotor FRONT LEFT : command == STOP

;#arc '9A/7a'
8.5s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 2
8.5s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == UP

;#arc '9A/7b'
9s A F Drive : speed == SLOW

;****verify postcondition
10s A N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT LEFT : getValue == true
10s A F DoorMotor FRONT LEFT : command == STOP
10s A F Drive : direction == UP