; 18649 Fall 2013
; group 17
; Qiang Zhang (qiangz)
; sd7a.mf

;network message period
#DEFINE MESSAGE_PERIOD 10ms

;definitions for inputs' id

;mAtFloor
;mAtFloor 3 FRONT ID = 0x0C4D6F00 + (3 - 1) * 2 + 0 = 0x0C4D6F04
#DEFINE AT_FLOOR_3F_FRONT_CAN_ID 0x0C4D6F04

;HallCall 3 FRONT UP
#DEFINE HALLCALL_3FU_CAN_ID 0x0CB17808

;mDesiredFloor
;ID = 0x0C4E7000
#DEFINE DESIRED_FLOOR_CAN_ID 0x0C4E7000

;mDoorOpened
;mDoorOpened Front Left ID = 0x0D157C00 + 0 + 0 = 0x0D157C00
#DEFINE DOOR_OPENED_FRONT_LEFT_CAN_ID 0x0D157C00

;mDoorClosed
;mDoorClosed Front Left ID = 0x0CB27900 + 0 + 0 = 0x0CB27900
#DEFINE DOOR_CLOSED_FRONT_LEFT_CAN_ID 0x0CB27900
;mDoorClosed Front Right ID = 0x0CB27900 + 0 + 1 = 0x0CB27901
#DEFINE DOOR_CLOSED_FRONT_RIGHT_CAN_ID 0x0CB27901
;mDoorClosed Back Left ID = 0x0CB27900 + 1*2 + 0 = 0x0CB27902
#DEFINE DOOR_CLOSED_BACK_LEFT_CAN_ID 0x0CB27902
;mDoorClosed Back Right ID = 0x0CB27900 + 1*2 + 1 = 0x0CB27903
#DEFINE DOOR_CLOSED_BACK_RIGHT_CAN_ID 0x0CB27903


;mCarWeight
;ID = 0x0D187E00
#DEFINE CAR_WEIGHT_CAN_ID 0x0D187E00

;mDriveSpeed = 0x0BE86400
#DEFINE DRIVE_SPEED_CAN_ID 0x0BE86400
;---------------------------------------------

;initialize
0s I MESSAGE_PERIOD N AT_FLOOR_3F_FRONT_CAN_ID AtFloor 3 FRONT = true
0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0s I MESSAGE_PERIOD N DOOR_OPENED_FRONT_LEFT_CAN_ID  DoorOpened  FRONT LEFT  = false
0s I MESSAGE_PERIOD N DOOR_CLOSED_FRONT_LEFT_CAN_ID  DoorClosed  FRONT LEFT  = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_FRONT_RIGHT_CAN_ID DoorClosed  FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_BACK_LEFT_CAN_ID   DoorClosed  BACK  LEFT  = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_BACK_RIGHT_CAN_ID  DoorClosed  BACK  RIGHT = true
0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0
0s I MESSAGE_PERIOD N HALLCALL_3FU_CAN_ID HallCall 3 FRONT UP = true

;#arc '7A/1a'
0.2s I MESSAGE_PERIOD N DOOR_CLOSED_FRONT_LEFT_CAN_ID DoorClosed FRONT LEFT = false;

;#arc '7A/2a'
1.0s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN
1.0s A F DoorMotor FRONT LEFT : command == OPEN
1.0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP

;#arc '7A/1b'
1.8s A S LanternControl[UP] : STATE == Lantern_On
1.8s A F CarLantern UP : lighted == true

;#arc '7A/1c'
1.8s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == UP


;#arc '7A/3a'
2.0s I MESSAGE_PERIOD N DOOR_OPENED_FRONT_LEFT_CAN_ID DoorOpened FRONT LEFT = true

;#arc '7A/3b'
2.2s A F DoorMotor FRONT LEFT : command == STOP
2.2s A S DoorControl[FRONT][LEFT] : STATE == OPENED

;#arc '7A/4'
14.0s A F DoorMotor FRONT LEFT : command == CLOSE
14.0s A S DoorControl[FRONT][LEFT] : STATE == CLOSING
14.0s I MESSAGE_PERIOD N DOOR_OPENED_FRONT_LEFT_CAN_ID DoorOpened FRONT LEFT = false

;#arc '7A/5a' '7A/6a'
15.0s I MESSAGE_PERIOD N DOOR_CLOSED_FRONT_LEFT_CAN_ID DoorClosed FRONT LEFT = true

;#arc '7A/5b'
16.2s A S DoorControl[FRONT][LEFT] : STATE == CLOSED
16.2s A F DoorMotor FRONT LEFT : command == STOP

;#arc '7A/6b'
16.4s A S LanternControl[UP] : STATE == Lantern_Off
16.4s A F CarLantern UP : lighted == false



















