;18649 Fall 2013
;Group: #17
;Qiang Zhang (qiangz) Shen Yu (sheny)
;sd7b.mf

;network message period
#DEFINE MESSAGE_PERIOD 0.01s

;mAtFloor 4 FRONT ID = 0x0C4C2800 + (4-1) * 2 + 0
#DEFINE AT_FLOOR_4F_CAN_ID 0xC4C2806
;mDesiredFloor
#DEFINE DESIRED_FLOOR_CAN_ID 0x0F0CB600
;mDoorClosed FRONT LEFT ID = 0x0D145000 + 0*2 + 1
#DEFINE DOOR_CLOSED_FL_CAN_ID 0x0D145001
;mDoorOpened FRONT LEFT ID = 0x0EA4A001
#DEFINE DOOR_OPENED_FL_CAN_ID 0x0EA4A001
;mDriveSpeed = 0x0F0AB500
#DEFINE DRIVE_SPEED_CAN_ID 0x0F0AB500
;mCarWeight = 0x0DDC7800
#DEFINE CAR_WEIGHT_CAN_ID 0x0DDC7800

;initialize
0.00s I MESSAGE_PERIOD N AT_FLOOR_4F_CAN_ID AtFloor 4 FRONT = true
0.00s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT STOP
0.00s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT RIGHT = true
0.00s I MESSAGE_PERIOD N DOOR_OPENED_FL_CAN_ID DoorOpened FRONT RIGHT = false
0.00s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0
0.00s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveCommand = SLOW UP

;****verify precondition
0.40s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveCommand = STOP STOP
0.41s A F DoorMotor FRONT RIGHT : command == STOP
0.41s A S DoorControl[FRONT][RIGHT] : STATE == CLOSED 

;#arc '7B/1a'
1.05s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT RIGHT = false
1.10s A F DoorMotor FRONT RIGHT : command == OPEN
1.10s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN
1.10s A S DoorControl[FRONT][RIGHT] : STATE == BEFORE_OPEN 
1.10s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 1 FRONT STOP

;#arc '7B/2a'
2.00s I MESSAGE_PERIOD N DOOR_OPENED_FL_CAN_ID DoorOpened FRONT RIGHT = true

;#arc '7B/2b'
3.00s A F DoorMotor FRONT RIGHT : command == STOP
3.00s A S DoorControl[FRONT][RIGHT] : STATE == OPENED

;#arc '7B/3'
5.00s I MESSAGE_PERIOD N DOOR_OPENED_FL_CAN_ID DoorOpened FRONT RIGHT = false
5.00s A F DoorMotor FRONT RIGHT : command == NUDGE
5.00s A S DoorControl[FRONT][RIGHT] : STATE == CLOSING

;#arc '7B/4a'
6.00s I MESSAGE_PERIOD N DOOR_CLOSED_FL_CAN_ID DoorClosed FRONT RIGHT = true

;#arc '7B/4b'
7.00s A F DoorMotor FRONT RIGHT : command == STOP
7.00s A S DoorControl[FRONT][RIGHT] : STATE == CLOSED
