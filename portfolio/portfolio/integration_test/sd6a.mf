; 18649 Fall 2013
; Group 17
; Jiang He (jiangh)
; sd6a.mf

;network message period
#DEFINE MESSAGE_PERIOD 10ms

;mLevel
#DEFINE LEVEL_SENSOR_[UP]_CAN_ID                       0x09F40A00
#DEFINE LEVEL_SENSOR_[DOWN]_CAN_ID                     0x09F40A01

#DEFINE DESIRED_FLOOR_CAN_ID 						   0x0C4E7000

;mDrive
#DEFINE DRIVE_COMMAND_CAN_ID						   0x0BE96400
;mDriveSpeed
#DEFINE DRIVE_SPEED_CAN_ID                             0x0BE86400

;mDoorClosed
#DEFINE DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID        0x0CB27900
#DEFINE DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID       0x0CB27901
#DEFINE DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID         0x0CB27902
#DEFINE DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID        0x0CB27903

;mAtFloor
#DEFINE AT_FLOOR_[1][FRONT]_CAN_ID                     0xC4D6F00
#DEFINE AT_FLOOR_[1][BACK]_CAN_ID                      0xC4D6F01
#DEFINE AT_FLOOR_[2][BACK]_CAN_ID                      0xC4D6F03
#DEFINE AT_FLOOR_[3][FRONT]_CAN_ID                     0xC4D6F04
#DEFINE AT_FLOOR_[4][FRONT]_CAN_ID                     0xC4D6F06
#DEFINE AT_FLOOR_[5][FRONT]_CAN_ID                     0xC4D6F08
#DEFINE AT_FLOOR_[6][FRONT]_CAN_ID                     0xC4D6F0A
#DEFINE AT_FLOOR_[7][FRONT]_CAN_ID                     0xC4D6F0C


#DEFINE DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID 0x0BEA6500
#DEFINE DOOR_MOTOR_COMMAND_[FRONT][RIGHT]_CAN_ID 0x0BEA6501
#DEFINE DOOR_MOTOR_COMMAND_[BACK][LEFT]_CAN_ID 0x0BEA6502
#DEFINE DOOR_MOTOR_COMMAND_[BACK][RIGHT]_CAN_ID 0x0BEA6503

;Car Level Position
#DEFINE CAR_LEVEL_POSITION_CAN_ID 0x0C517200

;initialization
0s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
0s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true

0s I MESSAGE_PERIOD N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotor FRONT LEFT = STOP
0s I MESSAGE_PERIOD N DOOR_MOTOR_COMMAND_[FRONT][RIGHT]_CAN_ID DoorMotor FRONT RIGHT = STOP
0s I MESSAGE_PERIOD N DOOR_MOTOR_COMMAND_[BACK][LEFT]_CAN_ID DoorMotor BACK LEFT = STOP
0s I MESSAGE_PERIOD N DOOR_MOTOR_COMMAND_[BACK][RIGHT]_CAN_ID DoorMotor BACK RIGHT = STOP

0s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
0s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = false
0s I MESSAGE_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false

0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID    DesiredFloor = 1 FRONT STOP

;#arc '6A/1'
1.0s A F CarPositionIndicator : floor == 1

;set conditions
1.5s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 2 BACK STOP

;#arc '6A/2a'
;check Drive is SLOW UP, mDrive is SLOW UP and STATE is SLOW_UP
2.3s A F Drive : speed == SLOW
2.3s A F Drive : direction == UP
2.3s A N DRIVE_COMMAND_CAN_ID DriveCommand : getSpeed == SLOW
2.3s A N DRIVE_COMMAND_CAN_ID DriveCommand : getDirection == UP
2.3s A S DriveControl : STATE == SLOW_UP

;set conditions
3.2s I MESSAGE_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = false

;#arc '6A/3a' '6A/4a'
3.5s I MESSAGE_PERIOD N AT_FLOOR_[2][BACK]_CAN_ID AtFloor 2 BACK = true
3.5s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 2 BACK STOP

3.9s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = false
3.9s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = false

4.3s I MESSAGE_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true
4.3s I MESSAGE_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

;#arc '6A/3b'
5s A F Drive : speed == STOP
5s A N DRIVE_COMMAND_CAN_ID DriveCommand : getSpeed == STOP

;#arc '6A/4b'
5s I MESSAGE_PERIOD N CAR_LEVEL_POSITION_CAN_ID CarLevelPosition = 3000
5.5s A F CarPositionIndicator : floor == 2







