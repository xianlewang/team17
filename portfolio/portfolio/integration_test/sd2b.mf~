; 18649 Fall 2013
; Group 17
; Shen Yu (sheny)
; sd2b.mf

;can id used
#DEFINE ATFLOOR_4F_CAN_ID                      0x0C4D6F06
#DEFINE DESIRED_FLOOR_CAN_ID                   0x0C4E7000
#DEFINE DOOR_CLOSED_SENSOR_F_L_CAN_ID          0x0CB27900
#DEFINE DOOR_CLOSED_SENSOR_F_R_CAN_ID          0x0CB27901
#DEFINE DOOR_OPEN_SENSOR_F_L_CAN_ID            0x0D157C00
#DEFINE DRIVE_SPEED_CAN_ID                     0x0BE86400
#DEFINE DOOR_REVERSAL_SENSOR_F_L_CAN_ID        0x0BEB6600
#DEFINE CAR_CALL_4F_CAN_ID                     0x0CB47A06
#DEFINE CAR_WEIGHT_CAN_ID                      0x0D187E00

;message period
#DEFINE MESSAGE_PERIOD 10ms

;initialize
0s I MESSAGE_PERIOD F CarCall 4 FRONT = false
0s I MESSAGE_PERIOD N ATFLOOR_4F_CAN_ID AtFloor 4 FRONT = false
0s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT UP
0s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 UP
0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_F_L_CAN_ID DoorOpened FRONT LEFT = false
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_L_CAN_ID DoorClosed FRONT LEFT = true
0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_R_CAN_ID DoorClosed FRONT RIGHT = true
0s I MESSAGE_PERIOD N DOOR_REVERSAL_SENSOR_F_L_CAN_ID DoorReversal FRONT LEFT = false
0s I MESSAGE_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 0

0.2s I MESSAGE_PERIOD N ATFLOOR_4F_CAN_ID AtFloor 4 FRONT = true
0.2s I MESSAGE_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT STOP
0.2s I MESSAGE_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0.2s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_L_CAN_ID DoorClosed FRONT LEFT = false
0.2s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_R_CAN_ID DoorClosed FRONT RIGHT = false

0.4s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_F_L_CAN_ID DoorOpened FRONT LEFT = true

;#arc '2B/1'
5.0s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_F_L_CAN_ID DoorOpened FRONT LEFT = false
5.6s A F DoorMotor FRONT LEFT : command == CLOSE
5.6s A S DoorControl[FRONT][LEFT] : STATE == CLOSING

;#arc '2B/2'
;#arc '2B/3A'
7s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_L_CAN_ID DoorClosed FRONT LEFT = true
7s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_R_CAN_ID DoorClosed FRONT RIGHT = true
7s I MESSAGE_PERIOD F CarCall 4 FRONT = true

;#arc '2B/3B'
7.4s A F CarLight 4 FRONT : isLighted == true

;#arc '2B/4A'
7.4s A N CAR_CALL_4F_CAN_ID CarCall 4 FRONT : getValue == true
7.4s A S CarButtonControl[4][FRONT] : STATE == STATE_LIGHT_ON

7.8s I MESSAGE_PERIOD F CarCall 4 FRONT = false

;#arc '2B/4B'
10.0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_L_CAN_ID DoorClosed FRONT LEFT = false
10.0s I MESSAGE_PERIOD N DOOR_CLOSED_SENSOR_F_R_CAN_ID DoorClosed FRONT RIGHT = false
10.0s A F DoorMotor FRONT LEFT : command == OPEN
10.0s A S DoorControl[FRONT][LEFT] : STATE == BEFORE_OPEN

;#arc '2B/5A'
11.2s I MESSAGE_PERIOD N ATFLOOR_4F_CAN_ID AtFloor 4 FRONT = true

;#arc '2B/5B'
11.4s A F CarLight 4 FRONT : isLighted == false
11.4s A S CarButtonControl[4][FRONT] : STATE == STATE_LIGHT_OFF

;#arc '2B/6A'
11.4s I MESSAGE_PERIOD N DOOR_OPEN_SENSOR_F_L_CAN_ID DoorOpened FRONT LEFT = true

;#arc '2B/6B'
11.6s A F DoorMotor FRONT LEFT : command == STOP
11.6s A S DoorControl[FRONT][LEFT] : STATE == OPENED


















